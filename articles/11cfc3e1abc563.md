---
title: "dotfiles管理、miseに全部任せてみた"
emoji: "🔧"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["mise", "dotfiles"]
published: true
---

# はじめに

## miseとは

https://mise.jdx.dev/

上記公式ドキュメントのHomeで強調されている通りですが、

- Dev Tools
  - asdfのような開発ツール管理
- Environments
  - direnvのような環境変数管理
- Tasks
  - makeのようなタスクランナー

の3つの機能をコンセプトに挙げているCLIツールです。

zenn記事での実践例だと、以下が参考になります。

https://zenn.dev/dress_code/articles/a99ff13634bbe6

## 経緯

私は業務・個人開発共にmiseを愛用しているのですが、開発環境をIaCのように静的なmiseの設定ファイルで記述するのはプロジェクト（リポジトリ）単位がほとんどでした。

マシンに対してグローバルに適用するdotfiles管理での設定ファイル記述はmise Dev Tools機能の活用に留めていましたが、今回その他の機能も活用してdotfiles管理をmiseに集約したので記事として残します。

## 成果物

以下、dotfilesリポジトリです

https://github.com/boykush/dotfiles

今回紹介する設定ファイル群は以下のような配置になっています

```
dotfiles/
├── mise/
│   ├── config.toml
│   ├── hooks/
│   │   └── postinstall.sh
│   └── tasks/
│       └── fbr
├── .zshrc
└── setup-mise.sh
```

# CLIツールのbrew->mise Dev Tools管理移行

https://mise.jdx.dev/dev-tools/

これまでグローバルな開発ツールに対しては、　`mise use -g node` のように動的にインストールをすることが多かったのですが、[mise Registry](https://mise.jdx.dev/registry.html)に登録されているCLIツールは徹底的にbrewからmise設定ファイル管理に移行しました。

miseはnpm,cargoといったBackend経由でのCLIインストールにも対応しているのでかなりの数のCLIツールを管理できます。

**サンプルコード:**
```toml:dotfiles/mise/config.toml
[tools]
node = "22"
python = "3"

# CLI tools (migrated from brew)
bat = "0.26.1"
delta = "0.18.2"
eza = "0.23.4"
fzf = "0.67.0"
gitui = "0.28.0"
neovim = "0.11.5"
...
```

例として[Renovateはmise設定ファイルのバージョン更新に対応している](https://docs.renovatebot.com/modules/manager/mise/)ので、静的バージョン管理を行うことができます。

# 環境変数のzshrc->mise Environments移行

https://mise.jdx.dev/environments/

これはmiseの基本機能であり移行をサボっていただけですが、　`EDITOR = "nvim"` のようなグローバル環境変数もmiseに集約させました。環境変数一覧は`mise env`コマンドから閲覧可能です。

**サンプルコード:**
```toml:dotfiles/mise/config.toml
[env]
XDG_CONFIG_HOME = "~/.config"
LANG = "ja_JP.UTF-8"
EDITOR = "nvim"
BAT_THEME = "Nord"
```

余談ですが、miseの環境変数管理はプロジェクト単位でスコープを切るのに加え、 `MISE_ENV` 引数で実行環境を切り替える機能が便利で推しています。

https://mise.jdx.dev/configuration/environments.html

# シェルエイリアスのzshrc->mise shell_alias移行

https://mise.jdx.dev/shell-aliases.html

miseに集約するにあたりzshrcファイルをなるべく軽くしようと考えていたところ、2025年11月にリリースされた新機能として `[shell_alias]` の設定が可能でした。

**サンプルコード:**
```toml:dotfiles/mise/config.toml
[shell_alias]
vi = "nvim"
ls = "eza"
ll = "eza -l -g --icons --git"
la = "eza -l -g --icons --git -a"
lt = "eza --tree --icons --git-ignore"
```

# カスタムスクリプトのzshrc->File Tasks移行

https://mise.jdx.dev/tasks/file-tasks.html

mise Tasksはmakeのようなタスクランナー機能を提供しますが、個人的にはその中でもTask別にファイルを切るFile Tasksの記法が気に入っています。グローバルに利用するカスタムスクリプトもmise Taskとして扱い、前述したシェルエイリアスで `mise run` Task呼び出しをできるようにしました。

以下は、fzfによってブランチ検索+checkoutするスクリプト例です

**サンプルコード:**
```bash:dotfiles/mise/tasks/fbr
#!/usr/bin/env bash
#MISE description="checkout git branch (including remote branches)"
#MISE dir="{{cwd}}"

branch=$(git branch --all | grep -v HEAD | fzf +m) &&
git checkout $(echo "$branch" | sed "s/.* //" | sed "s#remotes/[^/]*/##")
```

```toml:dotfiles/mise/config.toml
[shell_alias]
fbr = "mise run fbr"

[task_config]
dir = "{{ config_root }}/tasks"
```

スクリプトファイルの `#MISE dir="{{cwd}}"` によって実行元ディレクトリでのブランチ検索を行う考慮が必要です。このような考慮から少々無理矢理感はありましたが、せっかくなので。

# セットアップスクリプトのpostinstall移行

https://mise.jdx.dev/hooks.html

`setup.sh`のような初期セットアップスクリプトがあったのですが、Dev Toolsのインストールを行う `mise install` コマンド実行後に発火する postinstall hooksによってセットアップスクリプトの実行をワークフロー化しました。

mise Registryには含まれていないツールのbrew installや、dotfilesディレクトリ内に含む各開発ツール設定ファイルのシンボリックリンクを貼るスクリプトを移行しています。

**サンプルコード:**
```toml:dotfiles/mise/config.toml
[settings]
experimental = true

[hooks]
postinstall = "sh ./hooks/postinstall.sh"
```

```bash:dotfiles/mise/hooks/postinstall.sh
#!/bin/sh
dotfiles=$(cd "$(dirname "$0")/.." && pwd)

# Install brew tools (GUI apps, fonts, tools not in mise registry)
brew_tools=(procs arc wezterm font-hack-nerd-font visual-studio-code)
for tool in "${brew_tools[@]}"; do
  if ! brew list "$tool" &>/dev/null; then
    brew install "$tool"
  fi
done

# Create symlinks
ln -sf "$dotfiles/.gitconfig" ~/.gitconfig
ln -sf "$dotfiles/git" ~/.config/git
ln -sf "$dotfiles/zellij" ~/.config/zellij
ln -sf "$dotfiles/wezterm" ~/.config/wezterm
ln -sf "$dotfiles/nvim" ~/.config/nvim
```

これにより `mise install` コマンドで開発ツールのインストールとセットアップを行うようになり、認知負荷が減りました。

hooks機能はexperimentalではありますがかなり便利なのでgeneral昇格に期待です。

# まとめ

miseは抽象的に開発環境を扱うので、zshへの依存を減らすことができてハッピーです。

これからのAI開発にはIDEが要らないと呼ばれるような世の中ですし、改めてCLI環境に目を向けて楽しいdotfiles管理を行うことができました。
